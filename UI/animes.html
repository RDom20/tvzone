<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TVZone</title>
  <style>
    /* Basic reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #9d9eb127;
      color: #333;
      line-height: 1.6;
      max-width: 1920px;
      margin: 0 auto;
    }

    .hover:hover {
      transform: scale(1.2);
      transition: transform 0.2s ease-in-out, font-size 0.2s ease-in-out;
    }

    button {
      list-style: none;
      appearance: none;
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      font-family: Arial, sans-serif;
      font-size: 22px;
      font-weight: bold;
      color: inherit;
      cursor: pointer;
    }

    header {
      background-color: #122f6b;
      color: #ffffff;
      padding: 20px 0;
    }

    header .container {
      max-width: 1920px;
      margin: 0 auto;
      padding: 0 15px;

      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* LEFT SIDE: Logo + nav links */
    .nav-left {
      display: flex;
      align-items: center;
      gap: 35px;
      /* egys√©ges t√°vols√°g a linkek k√∂z√∂tt */
      padding: 0 20px;
      /* egyforma bels≈ë t√°vols√°g a sz√©lekt≈ël */
      flex-shrink: 0;
    }

    .logo {
      display: flex;
      align-items: center;
      height: 60px;
      padding-left: 20px;
    }

    .logo img {
      height: 60px;
      width: 90px;
      margin-left: 20px;
      stroke: #ffffff;
      cursor: pointer;
      transition: transform 0.2s ease;
      transform: scale(2.5);
    }

    .logo img:hover {
      transform: scale(3);
      margin-bottom: 5px;
    }


    /* CENTER: Search bar and nav styles */

    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      /* egys√©ges t√°vols√°g a linkek k√∂z√∂tt */
      margin: 0;
      /* elt√°vol√≠tjuk az alap margin-t */
      padding: 0;
      /* elt√°vol√≠tjuk az alap padding-et */
    }

    nav ul li a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 30px;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    nav ul li a:hover {
     transform: scale(1.5);
    }

    .nav-center {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      /* fixed: was 'center-100' */
      padding: 0 10px;
      min-width: 600px;
      position: relative;
      /* for icon positioning */
      max-width: 400px;
      /* control max width */
      width: 100%;
      /* full width in container */
      /* if there is any margin-left causing the offset */

    }

    .nav-center input[type="search"] {
      width: 100%;
      padding: 8px 20px 8px 40px;
      /* left padding for icon */
      border: none;
      border-radius: 4px;
      font-size: 20px;
      box-sizing: border-box;
      outline: none;
      color: #060316;
    }

    /* Search icon inside input */
    .nav-center svg.search-icon {
      position: absolute;
      top: 45%;
      left: 10px;
      transform: translateY(-50%);
      width: 25px;
      height: 25px;
      stroke: #060316;
      pointer-events: none;
      /* allows clicking input under icon */
    }

    #theme-toggle {
      font-size: 90px;
      /* üî∏ Itt √°ll√≠thatod a m√©retet ‚Äî pl. 24px, 28px, 32px */
      height: 40px;
      width: 40px;
      cursor: pointer;
      transition: transform 0.2s ease;
      transform: scale(2.5);
      margin-right: 20px;
      margin-top: 20px;
    }

    #theme-toggle:hover {
      transform: scale(3.5);

    }

    /* RIGHT SIDE: Login button */
    .nav-right {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-right: 10px;
      /* No need for extra spacing, gap handles it */
    }

    .nav-right ul {
      list-style: none;
      margin-right: 20px;
      padding: 0;
      display: flex;
    }

    .nav-right ul li a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 30px;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    .nav-right ul li a:hover {
      transform: scale(1.5);
    }

    .login-btn {
      background-color: transparent;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 30px;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    .login-btn:hover {
      transform: scale(1.5);
    }

    /* Main content styling (your original styles) */
    main {
      max-width: 1920px;
      margin: 40px auto;
      padding: 0 15px;
    }

    section {
      margin-bottom: 50px;
    }

    section h2 {
      position: relative;
      margin-left: 10px;
      font-size: 35px;
      color: #122f6b;
      padding-bottom: 10px;
      width: fit-content;
    }

    /* Lekerek√≠tett als√≥ szeg√©ly */
    section h2::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      height: 10px;
      width: 120%;
      background-color: #122f6b;
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .carousel-wrapper {
      position: relative;
    }

    .carousel {
      overflow: hidden;
      width: 1800px;
      height: 500px;
      margin: 0 auto;
      /* EZ teszi k√∂z√©pre */
      overflow: hidden;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.5s ease-in-out;
      gap: 10px;
      margin-left: 5px;
      /* Kiv√°ltja a margin-right-ot */
    }

    .carousel-item {
      flex: 0 0 calc((100% - 45px) / 5);
      /* 5 elem k√∂z√∂tt 4 r√©s van, azaz 4 * 10px = 40px */
      background: #9d9eb127;
      border-radius: 6px;
      box-shadow: 0 2px 6px #0000001a;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .carousel-item img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      display: block;
      border-bottom: 1px solid #ddd;
    }

    .carousel-item .info {
      padding: 12px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .carousel-item .info h3 {
      font-size: 20px; 
      margin-bottom: 6px;
      color: #122f6b;
      font-weight: bold;
    }

    .carousel-item .info p {
      font-size: 18px; 
      color: #173c88;
      font-weight: bold;
    }

    .carousel-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(18, 47, 107, 0.7);
      border: none;
      color: white;
      padding: 8px 14px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 30px;
      z-index: 10;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    .carousel-button:hover {
      background-color: #122f6b;
    }

    .carousel-button.prev {
      left: 0;
    }

    .carousel-button.next {
      right: 0;
    }

    footer {
      background-color: #122f6b;
      color: #ccc;
      padding: 25px 0;
      text-align: center;
      margin-top: 50px;
    }

    footer a {
      color: #fff;
      margin: 0 12px;
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media(max-width: 900px) {
      .carousel-item img {
        height: 220px;
      }
    }

    @media(max-width: 700px) {
      .carousel-item {
        min-width: calc(100% / 3);
      }
    }

    @media(max-width: 450px) {
      .carousel-item {
        min-width: calc(100% / 2);
      }

      header .container {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .nav-left,
      .nav-center,
      .nav-right {
        flex-basis: 100%;
        justify-content: center;
      }

      nav ul {
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

    }

        /* Dark mode styling */
    body.dark-mode {
      background-color: #1a1a1a;
      color: #060316;
    }

    body.dark-mode header {
      background-color: #0a1b3f;
      color: #b8b8b8;
    }

    body.dark-mode header .nav-center input[type="search"] {
      background-color: #060316;
      color: #b8b8b8;
    }

    body.dark-mode header .nav-center svg.search-icon {
      color: #b8b8b8;
    }

    body.dark-mode header nav a,
    body.dark-mode header .nav-right ul li a {
      color: #b8b8b8;
    }

    body.dark-mode #theme-toggle {
      fill: #b8b8b8;

    }

    body.dark-mode .login-btn {
      color: #b8b8b8;
    }

    body.dark-mode .carousel-item .info h3 {
      color: #283999;
    }

    /*color: #2b3ea7;
      text-shadow:
    -1px -1px 0 #6d7bca,  
     1px -1px 0 #6d7bca,
    -1px  1px 0 #6d7bca,
     1px  1px 0 #6d7bca;*/

    body.dark-mode .carousel-item .info p {
      color: #283999;
    }

    body.dark-mode h2 {
      color: #2c3c94;
    }

    body.dark-mode h2::after {
      background-color: #2c3c94;
    }

    body.dark-mode .carousel-button.prev {
      left: 0;
      background-color: #151c7c;
      color: #b8b8b8;
    }

    body.dark-mode .carousel-button.next {
      right: 0;
      background-color: #151c7c;
      color: #b8b8b8;
    }

    footer {
      background-color: #0a1b3f;
      color: #b8b8b8;
    }

    footer a {
      color: #b8b8b8;
    }
  </style>
</head>

<body>
    <header>
        <div class="container">
            <div class="nav-left">
                <a href="home.html" class="logo">
                    <img src="logo.png" alt="TVZone Logo" style="height: 50px;">
                </a>

                <nav>
                    <ul>
                        <li><a href="movies.html">Movies</a></li>
                        <li><a href="series.html">Series</a></li>
                        <li><a href="animes.html">Animes</a></li>
                        <li><a href="#">Filter</a></li>
                    </ul>
                </nav>
            </div>

            <div class="nav-center">
                <input type="search" placeholder="Search..." />
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="7"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </div>

            <div class="nav-right">
                <svg id="theme-toggle" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#ffffff"
                    viewBox="0 0 24 24" style="margin-left: 50px; cursor: pointer;">
                    <path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1021 12.79z"></path>
                </svg>
                <ul>
                    <li><a href="#">Contact</a></li>
                </ul>
                <button class="login-btn">Login</button>
                <script src="login.js"></script>
            </div>

    </header>

    <main>

      </const>
        <!-- Trending -->
        <section>
            <h2>Trending</h2>
            <div class="carousel-wrapper">
                <button class="carousel-button prev" data-carousel="trending">&#8249;</button>
                <div class="carousel" id="carousel-trending">
                    <div class="carousel-track">
                        <div class="carousel-item"><img src="about:blank" alt="cover" />
                            <div class="info">
                                <h3>Batman Begins</h3>
                                <p>Action ‚Ä¢ 2024</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="about:blank" alt="cover" />
                            <div class="info">
                                <h3>Sherlock</h3>
                                <p>Drama ‚Ä¢ 2023</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+3" />
                            <div class="info">
                                <h3>Dragon Ball - Mystical Great Adventure</h3>
                                <p>Sci-Fi ‚Ä¢ 2022</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+4" />
                            <div class="info">
                                <h3>Dragon Ball</h3>
                                <p>Comedy ‚Ä¢ 2021</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+5" />
                            <div class="info">
                                <h3>Trending Title 5</h3>
                                <p>Thriller ‚Ä¢ 2025</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+6" />
                            <div class="info">
                                <h3>Trending Title 6</h3>
                                <p>Horror ‚Ä¢ 2020</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+7" />
                            <div class="info">
                                <h3>Trending Title 7</h3>
                                <p>Romance ‚Ä¢ 2019</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+8" />
                            <div class="info">
                                <h3>Trending Title 8</h3>
                                <p>Fantasy ‚Ä¢ 2023</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+9" />
                            <div class="info">
                                <h3>Trending Title 9</h3>
                                <p>Adventure ‚Ä¢ 2024</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Trending+10" />
                            <div class="info">
                                <h3>Trending Title 10</h3>
                                <p>Documentary ‚Ä¢ 2022</p>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="carousel-button next" data-carousel="trending">&#8250;</button>
            </div>
        </section>

        <!-- Latest Series -->
        <section>
            <h2>Latest Series</h2>
            <div class="carousel-wrapper">
                <button class="carousel-button prev" data-carousel="series">&#8249;</button>
                <div class="carousel" id="carousel-series">
                    <div class="carousel-track">
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+1" />
                            <div class="info">
                                <h3>Series Title 1</h3>
                                <p>Action ‚Ä¢ 2024</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+2" />
                            <div class="info">
                                <h3>Series Title 2</h3>
                                <p>Drama ‚Ä¢ 2023</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+3" />
                            <div class="info">
                                <h3>Series Title 3</h3>
                                <p>Sci-Fi ‚Ä¢ 2022</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+4" />
                            <div class="info">
                                <h3>Series Title 4</h3>
                                <p>Comedy ‚Ä¢ 2021</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+5" />
                            <div class="info">
                                <h3>Series Title 5</h3>
                                <p>Thriller ‚Ä¢ 2025</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+6" />
                            <div class="info">
                                <h3>Series Title 6</h3>
                                <p>Horror ‚Ä¢ 2020</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+7" />
                            <div class="info">
                                <h3>Series Title 7</h3>
                                <p>Action ‚Ä¢ 2024</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+8" />
                            <div class="info">
                                <h3>Series Title 8</h3>
                                <p>Drama ‚Ä¢ 2023</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+9" />
                            <div class="info">
                                <h3>Series Title 9</h3>
                                <p>Sci-Fi ‚Ä¢ 2022</p>
                            </div>
                        </div>
                        <div class="carousel-item"><img src="https://via.placeholder.com/200x450?text=Series+10" />
                            <div class="info">
                                <h3>Series Title 10</h3>
                                <p>Comedy ‚Ä¢ 2021</p>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="carousel-button next" data-carousel="series">&#8250;</button>
            </div>
        </section>
    </main>

    <footer>
        &copy; 2024 TVZone. All rights reserved.
        <br />
        <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a>
    </footer>

 <script>
    // Preview Window
    // (carousel click handling moved lower to perform directory scan before navigation)

    function openPreview(title, description) {
      const previewOverlay = document.getElementById('previewOverlay');
      const previewVideo = document.getElementById('previewVideo');
      
      document.getElementById('previewTitle').textContent = title;
      document.getElementById('previewDescription').textContent = description;
      
      // Set preview video (trailer)
      previewVideo.src = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4';
      previewVideo.load();
      previewVideo.play();
      
      previewOverlay.style.display = 'flex';
    }

    function closePreview() {
      const previewOverlay = document.getElementById('previewOverlay');
      const previewVideo = document.getElementById('previewVideo');
      
      previewVideo.pause();
      previewOverlay.style.display = 'none';
    }

    // Full Video Player
    function openFullVideo() {
      closePreview();
      const videoOverlay = document.getElementById('videoOverlay');
      const mainVideo = document.getElementById('mainVideo');
      
      // Set full video source
      mainVideo.src = `C:\\Users\\rdomi\\OneDrive - Ny√≠regyh√°zi Egyetem (Student)\\TVZone\\data\\Movies\\${title}.mp4`;
      mainVideo.load();
      
      videoOverlay.style.display = 'block';
      mainVideo.play();
    }

    function closeFullVideo() {
      const videoOverlay = document.getElementById('videoOverlay');
      const mainVideo = document.getElementById('mainVideo');
      
      mainVideo.pause();
      videoOverlay.style.display = 'none';
    }

    function togglePlay() {
      const mainVideo = document.getElementById('mainVideo');
      const playIcon = document.getElementById('playIcon');
      
      if (mainVideo.paused) {
        mainVideo.play();
        playIcon.textContent = '‚ùö‚ùö';
      } else {
        mainVideo.pause();
        playIcon.textContent = '‚ñ∂';
      }
    }

    function skipTime(seconds) {
      const mainVideo = document.getElementById('mainVideo');
      mainVideo.currentTime += seconds;
    }

    function toggleMenu(menuType) {
      const menus = ['ccMenu', 'speedMenu', 'qualityMenu'];
      menus.forEach(menu => {
        const element = document.getElementById(menu);
        if (menu === menuType + 'Menu') {
          element.classList.toggle('active');
        } else {
          element.classList.remove('active');
        }
      });
    }

    function setSpeed(speed) {
      const mainVideo = document.getElementById('mainVideo');
      mainVideo.playbackRate = speed;
      document.querySelector('[title="Speed"]').textContent = speed + 'x';
      toggleMenu('speed');
    }

    function setQuality(quality) {
      // Implement quality change logic here
      document.querySelector('[title="Quality"]').textContent = quality;
      toggleMenu('quality');
    }

    function updateCCStyle(property, value) {
      const track = document.getElementById('mainVideo').textTracks[0];
      if (track) {
        // Implement CC style updates here
      }
    }

    function toggleReaction(type) {
      const button = document.querySelector(`[title="${type === 'superlike' ? 'Super Like' : type === 'like' ? 'Like' : 'Dislike'}"]`);
      button.classList.toggle('active');
    }

    function toggleWatchlist() {
      const button = document.querySelector('[title="Add to Watchlist"]');
      button.classList.toggle('active');
    }

    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      const mainVideo = document.getElementById('mainVideo');
      if (document.getElementById('videoOverlay').style.display === 'block') {
        switch(e.key.toLowerCase()) {
          case ' ':
            e.preventDefault();
            togglePlay();
            break;
          case 'f':
            e.preventDefault();
            if (!document.fullscreenElement) {
              document.getElementById('videoOverlay').requestFullscreen();
            } else {
              document.exitFullscreen();
            }
            break;
          case 'escape':
            if (document.fullscreenElement) {
              document.exitFullscreen();
            } else {
              closeFullVideo();
            }
            break;
          case 'arrowleft':
          case 'a':
            skipTime(-5);
            break;
          case 'arrowright':
          case 'd':
            skipTime(5);
            break;
        }
      }
    });

    // Update progress bar
    

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      seconds = Math.floor(seconds % 60);
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
  </script>

  <script>
  // === Carousel functionality ===
  document.querySelectorAll('.carousel-wrapper').forEach(wrapper => {
    const track = wrapper.querySelector('.carousel-track');
    const prevButton = wrapper.querySelector('.carousel-button.prev');
    const nextButton = wrapper.querySelector('.carousel-button.next');
    const items = wrapper.querySelectorAll('.carousel-item');
    const itemWidth = items[0].getBoundingClientRect().width + 10; // 10px gap

    let currentIndex = 0;

    prevButton.addEventListener('click', () => {
      currentIndex = Math.max(currentIndex - 1, 0);
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    });

    nextButton.addEventListener('click', () => {
      const maxIndex = items.length - Math.floor(wrapper.querySelector('.carousel').offsetWidth / itemWidth);
      currentIndex = Math.min(currentIndex + 1, maxIndex);
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    });

    window.addEventListener('resize', () => {
      // Reset transform on resize to prevent misalignment
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    });
  });

  // === Dark Mode Toggle ===
  const themeToggle = document.getElementById('theme-toggle');
  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    // Optional: store preference in localStorage
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
  });

  // Optional: load stored dark mode preference
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }

  // === Series Directory Scanner (calls local API) ===
  async function scanSeriesDirectory(title) {
    try {
      // call local server at :3000 (must be running)
      const resp = await fetch(`http://localhost:3000/api/scan?title=${encodeURIComponent(title)}`);
      if (!resp.ok) {
        console.error('API scan failed', resp.statusText);
        return null;
      }
      const data = await resp.json();
      // normalize to the shape details.html expects: { 'Season 1': [ {name,path,title}, ... ] }
      if (data && data.episodes) return data.episodes;
      return null;
    } catch (err) {
      console.error('Error calling scan API:', err);
      return null;
    }
  }

  async function fetchSeries(title) {
  try {
    const resp = await fetch(`http://localhost:3000/api/series?title=${encodeURIComponent(title)}`);
    if (!resp.ok) {
      console.error('API error', resp.statusText);
      return null;
    }
    const data = await resp.json();
    return data;
  } catch (err) {
    console.error('Fetch error', err);
    return null;
  }
}

  

  function openEpisodePlayer(ep, seasonKey, episodeIndex) {
    const videoOverlay = document.getElementById('videoOverlay');
    const mainVideo = document.getElementById('mainVideo');
    const titleElem = document.getElementById('videoTitle');
    const descElem = document.getElementById('videoDescription');

    // Vide√≥ forr√°s URL (streamel√©s a Node szerverr≈ël)
    const videoUrl = `http://localhost:3000${ep.path}`;
    console.log("‚ñ∂ Bet√∂lt√©s:", videoUrl);

    mainVideo.src = videoUrl;
    titleElem.textContent = `${seasonKey} ‚Ä¢ Episode ${episodeIndex + 1}`;
    descElem.textContent = ep.name || '';

    // Mutatjuk az overlayt
    videoOverlay.style.display = 'block';
    mainVideo.load();
    mainVideo.pause();

    alert(`${seasonKey} E${episodeIndex + 1} bet√∂ltve`);
  }

  function togglePlay() {
    const mainVideo = document.getElementById('mainVideo');
    const playIcon = document.getElementById('playIcon');

    if (mainVideo.paused) {
      mainVideo.play();
      playIcon.textContent = '‚ùö‚ùö';
    } else {
      mainVideo.pause();
      playIcon.textContent = '‚ñ∂';
    }
  }

  function closeEpisodePlayer() {
    const videoOverlay = document.getElementById('videoOverlay');
    const mainVideo = document.getElementById('mainVideo');
    mainVideo.pause();
    videoOverlay.style.display = 'none';
  }
</script>

<!-- Netflix-st√≠lus√∫ lej√°tsz√≥ -->
<div class="video-overlay" id="videoOverlay" style="display:none;">
  <button class="close-btn" onclick="closeEpisodePlayer()">‚úï</button>
  <div class="video-container">
    <video id="mainVideo" class="main-video" controls>
      <source src="" type="video/mkv" />
    </video>
    <div class="controls">
      <button onclick="togglePlay()"><span id="playIcon">‚ñ∂</span></button>
      <div><span id="currentTime">0:00</span> / <span id="duration">0:00</span></div>
    </div>
  </div>
  <div class="video-info">
    <h2 id="videoTitle"></h2>
    <p id="videoDescription"></p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
console.log('Setting up click handlers for carousel items');
document.getElementById('mainVideo').addEventListener('timeupdate', () => {
const mainVideo = document.getElementById('mainVideo');
const progress = document.getElementById('progress');
const currentTimeSpan = document.getElementById('currentTime');
const durationSpan = document.getElementById('duration');
const percent = (mainVideo.currentTime / mainVideo.duration) * 100;
progress.style.width = percent + '%';
currentTimeSpan.textContent = formatTime(mainVideo.currentTime);
durationSpan.textContent = formatTime(mainVideo.duration);
});
document.querySelectorAll('.carousel-item').forEach(item => {
item.addEventListener('click', async () => {
const title = item.querySelector('h3').textContent.trim();
console.log('Clicked series:', title); // Debug log
try {
const episodesData = await scanSeriesDirectory(title);
console.log('Scanned episodes data:', episodesData); // Debug log
if (episodesData && Object.keys(episodesData).length > 0) {
// √Åtir√°ny√≠t√°s a details.html-re az epiz√≥dokkal
const queryParams = new URLSearchParams({
title: title,
episodes: JSON.stringify(episodesData)
});
const url = 'details.html?' + queryParams.toString();
console.log('Redirecting to:', url); // Debug log
location.href = url;
} else {
console.error('No episodes found in directory');
// Fallback a sima √°tir√°ny√≠t√°sra
const url = 'details.html?title=' + encodeURIComponent(title);
location.href = url;
}
} catch (error) {
console.error('Error handling series click:', error);
const url = 'details.html?title=' + encodeURIComponent(title);
location.href = url;
}
});
});
});
</script>

<script src="auth.js"></script>

<script>
function checkAuth() {
return !!localStorage.getItem("loggedInUser");
}

// ha nincs bejelentkezve, visszadob loginra

</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
document.querySelectorAll(".carousel-item").forEach(item => {
const title = item.querySelector("h3")?.textContent.trim();
if (!title) return;
const img = item.querySelector("img");
if (!img) return;
// --- FIX bor√≠t√≥ √∫tvonal ---
const coverUrl = `http://localhost:3000/covers/${encodeURIComponent(title)}.jpg`;
// Pr√≥b√°ljuk bet√∂lteni
const testImg = new Image();
testImg.onload = () => {
img.src = coverUrl; // ha van tal√°lat ‚Üí be√°ll√≠tjuk
};
testImg.onerror = () => {
console.warn("‚ùå Nincs bor√≠t√≥ ehhez:", title);
img.src = "default-thumbnail.png"; // fallback k√©p
};
// induljon a bet√∂lt√©s
testImg.src = coverUrl;
});
});
</script>

<script>
/* COVER BET√ñLT≈ê (illessze be a </body> el√©) */
(async function loadCovers() {
const API_BASE = 'http://localhost:3000';
const coversApi = API_BASE + '/api/cover?title=';
const coversBase = API_BASE + '/covers/';
// minden carousel-item img-et feldolgozunk
document.querySelectorAll('.carousel-item').forEach(async (item) => {
try {
const img = item.querySelector('img');
if (!img) return;
// ha m√°r statikus, ne piszk√°ljuk (pl. placeholder vagy k√ºls≈ë URL)
const src = img.getAttribute('src') || '';
if (src.startsWith('http') && !src.includes('/covers/')) return;
// c√≠m kinyer√©se: el≈ësz√∂r <h3>, ha nincs, pr√≥b√°ljuk a data-title attrib√∫tumot
let title = '';
const h3 = item.querySelector('.info h3');
if (h3 && h3.textContent.trim()) title = h3.textContent.trim();
else if (item.dataset && item.dataset.title) title = item.dataset.title;
if (!title) {
// ha nincs c√≠m, hagyjuk a megl√©v≈ë src-t
return;
}
// 1) pr√≥b√°ljuk az API-t, ha el√©rhet≈ë
try {
const resp = await fetch(coversApi + encodeURIComponent(title));
if (resp.ok) {
const data = await resp.json();
if (data && data.url) {
img.onerror = () => { img.src = coversBase + encodeURIComponent(title) + '.jpg'; };
img.src = API_BASE + data.url;
return;
}
}
} catch (e) {
// API hiba: tov√°bbmegy√ºnk a fallbackre
console.warn('Cover API hiba:', e);
}
// 2) fallback: pr√≥b√°ljuk meg a szabv√°nyos n√©vvel (.jpg)
const fallback = coversBase + encodeURIComponent(title) + '.jpg';
img.onerror = () => { img.src = 'https://via.placeholder.com/400x640?text=No+Cover'; };
img.src = fallback;
} catch (err) {
console.error('Cover load error for item:', item, err);
}
});
})();
</script>

<script>
/**
 * Lek√©ri a szervert≈ël a felirat URL-j√©t c√≠m alapj√°n.
 * Visszat√©r: string URL vagy null.
 */
async function resolveSubtitleUrl(title) {
  const API_BASE = 'http://localhost:3000';
  try {
    const resp = await fetch(`${API_BASE}/api/subtitle?title=${encodeURIComponent(title)}`);
    if (!resp.ok) return null;
    const data = await resp.json();
    if (data && data.url) return API_BASE + data.url;
    return null;
  } catch (err) {
    console.warn('Subtitle API hiba:', err);
    return null;
  }
}

/**
 * Hozz√°ad egy <track> elemet a #mainVideo vide√≥hoz, ha tal√°lunk feliratot.
 * language: pl. 'hu' vagy 'en' (opcion√°lis)
 */
async function attachSubtitleToVideo(title, language = 'hu') {
  const video = document.getElementById('mainVideo');
  if (!video) return false;

  // t√∂r√∂lj√ºk a kor√°bbi trackeket
  Array.from(video.querySelectorAll('track')).forEach(t => t.remove());

  const url = await resolveSubtitleUrl(title);
  if (!url) return false;

  const track = document.createElement('track');
  track.kind = 'subtitles';
  track.label = language.toUpperCase();
  track.srclang = language;
  track.src = url;
  track.default = true;
  video.appendChild(track);

  // bet√∂lt√©s ut√°n aktiv√°ljuk (n√©h√°ny b√∂ng√©sz≈ën√©l kellhet)
  track.addEventListener('load', () => {
    try {
      track.mode = 'showing';
    } catch (e) { /* n√©h√°ny b√∂ng√©sz≈ëben read-only */ }
  });

  return true;
}

async function resolveSubtitleUrlByLang(title, language) {
  const API_BASE = 'http://localhost:3000';
  // normaliz√°ljuk a nyelvet a szerver √°ltal v√°rt form√°ra
  const langMap = {
    'english': 'eng',
    'eng': 'eng',
    'en': 'eng',
    'hungarian': 'hun',
    'hun': 'hun',
    'hu': 'hun'
  };
  const langKey = (language || '').toString().toLowerCase();
  const langParam = langMap[langKey] || '';

  try {
    const url = `${API_BASE}/api/subtitle?title=${encodeURIComponent(title)}${langParam ? '&lang=' + encodeURIComponent(langParam) : ''}`;
    const resp = await fetch(url);
    if (!resp.ok) return null;
    const data = await resp.json();
    if (data && data.url) return API_BASE + data.url;
    return null;
  } catch (err) {
    console.warn('Subtitle API hiba:', err);
    return null;
  }
}

async function attachSubtitleToVideo(title, language = 'English') {
  const video = document.getElementById('mainVideo');
  if (!video) return false;

  // t√∂r√∂lj√ºk a kor√°bbi trackeket
  Array.from(video.querySelectorAll('track')).forEach(t => t.remove());

  const url = await resolveSubtitleUrlByLang(title, language);
  if (!url) return false;

  const track = document.createElement('track');
  track.kind = 'subtitles';
  track.label = language;
  track.srclang = language.toLowerCase().startsWith('h') ? 'hu' : 'en';
  track.src = url;
  track.default = true;
  video.appendChild(track);

  track.addEventListener('load', () => {
    try { track.mode = 'showing'; } catch (e) {}
  });

  return true;
}
</script>

</body>

</html>

<!-- PageFooter="1" -->


